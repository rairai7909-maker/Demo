 -bottom: 2px solid var(--light-green);
            padding-bottom: 5px;
        }

        .diagnosis-content ul {
            padding-left: 20px;
            line-height: 1.6;
        }

        .diagnosis-content li {
            margin-bottom: 8px;
        }

        /* Marketing Section */
        .marketing-box {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            width: 100%;
            margin-top: 20px;
            box-shadow: var(--shadow);
        }

        .marketing-text {
            font-size: 1rem;
            color: #d84315;
            margin-bottom: 15px;
            font-weight: 500;
            line-height: 1.5;
        }

        .shop-btn {
            background-color: #d84315;
            color: white;
            text-decoration: none;
            display: inline-block;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
        }

        /* Error/Info Messages */
        .message-box {
            padding: 20px;
            background-color: #ffebee;
            color: #c62828;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        /* Hidden File Input */
        #file-input {
            display: none;
        }

        /* --- POPUP MODAL CSS --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            color: var(--primary-green);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            border-color: var(--primary-green);
            outline: none;
        }

        .btn-go {
            background: var(--accent-orange);
            color: white;
            width: 100%;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .close-modal {
            margin-top: 15px;
            color: #777;
            text-decoration: underline;
            cursor: pointer;
            font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <header>
        <img src="https://i.ibb.co/N6TCx6NB/IMG-20260116-120014.jpg" alt="Logo" class="app-logo">
        <h1>рдХрд┐рд╕рд╛рди рд╕реБрд░рдХреНрд╖рд╛</h1>
    </header>

    <main>
        <div id="landing-screen" class="screen active">
            <div class="hero-section">
                <h2 class="hero-title">рдирдорд╕реНрддреЗ рдХрд┐рд╕рд╛рди рднрд╛рдИ! ЁЯЩП</h2>
                <p class="hero-desc">рдХреНрдпрд╛ рдЖрдкрдХреА рдлрд╕рд▓ рдореЗрдВ рдХреЛрдИ рдмреАрдорд╛рд░реА рд▓рдЧ рдЧрдпреА рд╣реИ? рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, AI рдФрд░ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдХреА рдорджрдж рд╕реЗ рддреБрд░рдВрдд рдЬрд╛рдВрдЪ рдХрд░реЗрдВред</p>
                <button class="btn-primary" onclick="startApp()">ЁЯУ╕ рдлреЛрдЯреЛ рдЦреАрдВрдЪрдХрд░ рдмреАрдорд╛рд░реА рджреЗрдЦреЗрдВ</button>
            </div>

            <div class="faq-container">
                <details>
                    <summary>рдпрд╣ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреНрдпреЛрдВ рдмрдирд╛рдИ рдЧрдИ рд╣реИ?</summary>
                    <div class="faq-answer">рд╣рдорд╛рд░рд╛ рдЙрджреНрджреЗрд╢реНрдп рдХрд┐рд╕рд╛рди рднрд╛рдЗрдпреЛрдВ рдХреА рдорджрдж рдХрд░рдирд╛ рд╣реИред рдпрд╣ рд╡реЗрдмрд╕рд╛рдЗрдЯ AI рддрдХрдиреАрдХ рдФрд░ рд╣рдорд╛рд░реЗ рдХреГрд╖рд┐ рдЕрдиреБрднрд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдкрдХреА рдлрд╕рд▓ рдХреА рдмреАрдорд╛рд░реА рдХреЛ рддреБрд░рдВрдд рдкрд╣рдЪрд╛рдирддреА рд╣реИред</div>
                </details>
                <details>
                    <summary>рдЕрдЧрд░ рдмреАрдорд╛рд░реА рдорд┐рд▓реЗ рддреЛ рджрд╡рд╛рдИ рдХрд╣рд╛рдБ рд╕реЗ рд▓реЗрдВ?</summary>
                    <div class="faq-answer">рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдмрд╣реБрдд рд╕реА рдирдХрд▓реА рджрд╡рд╛рдЗрдпрд╛рдВ рдмрд┐рдХ рд░рд╣реА рд╣реИрдВред рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА рдлрд╕рд▓ рдХреЛ рдмрдЪрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ <strong>рд╕рд┐рд░реНрдл рдФрд░ рд╕рд┐рд░реНрдл рд╣рдорд╛рд░реА рджреБрдХрд╛рди (рд╢реЙрдк)</strong> рд╕реЗ рд╣реА рджрд╡рд╛рдИ рдЦрд░реАрджреЗрдВред</div>
                </details>
                <details>
                    <summary>рдпрд╣рд╛рдБ рд╕реЗ рджрд╡рд╛рдИ рд▓реЗрдиреЗ рдХреЗ рдХреНрдпрд╛ рдлрд╛рдпрджреЗ рд╣реИрдВ?</summary>
                    <div class="faq-answer">
                        <ul>
                            <li>тЬЕ 100% рдУрд░рд┐рдЬрд┐рдирд▓ (рдЕрд╕рд▓реА) рдХрдВрдкрдиреА рдХрд╛ рдорд╛рд▓ред</li>
                            <li>тЬЕ рдлрд╕рд▓ рдХреЗ рд░реЛрдЧ рдХреЗ рд╣рд┐рд╕рд╛рдм рд╕реЗ рдмрд┐рд▓реНрдХреБрд▓ рд╕рдЯреАрдХ рджрд╡рд╛рдИред</li>
                            <li>тЬЕ рдмрд╛рдЬрд╛рд░ рд╕реЗ рдЙрдЪрд┐рдд рджрд╛рдоред</li>
                            <li>тЬЕ рдЧреЛрдкрд╛рд▓ рдЬреА рднрд╛рдИрд╕рд╛рдм (рдХреГрд╖рд┐ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ) рджреНрд╡рд╛рд░рд╛ рдореБрдлреНрдд рд╕рд▓рд╛рд╣ред</li>
                        </ul>
                    </div>
                </details>
                <details>
                    <summary>рджреБрдХрд╛рди рдХрд╛ рдкрддрд╛ (Address) рдХреНрдпрд╛ рд╣реИ?</summary>
                    <div class="faq-answer" style="font-weight: bold; color: var(--primary-green);">
                        ЁЯУН рдкрддрд╛:<br>Main Road Badayala Mataji,<br>Tahasil Piploda, Jila Ratlam,<br>State Madhya Pradesh.
                    </div>
                </details>
            </div>

            <div class="ceo-section">
                <img src="https://firebasestorage.googleapis.com/v0/b/go-play-b8c0c.appspot.com/o/Storege%2FIMG_20260116_101546.jpg?alt=media&token=7f9729dc-c92c-4233-b51f-74a53449cf63" alt="Gopal Dhangar" class="ceo-img">
                <div class="ceo-name">рдЧреЛрдкрд╛рд▓ рдзрдирдЧрд░ (Gopal Dhangar)</div>
                <div class="ceo-badge">ЁЯСитАНЁЯМ╛ рдХреГрд╖рд┐ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ (Agriculture Expert)</div>
                <p class="ceo-bio">"рдлрд╕рд▓реЛрдВ рдХреА рд╣рд░ рдмреАрдорд╛рд░реА рдХрд╛ рд╕рд╣реА рдЗрд▓рд╛рдЬ рдФрд░ рд╕рд╣реА рд╕рд▓рд╛рд╣ред рд╣рдорд╛рд░рд╛ рдЕрдиреБрднрд╡ рдФрд░ рдЖрдкрдХреА рдореЗрд╣рдирдд, рд▓рд╛рдПрдЧреА рдлрд╕рд▓ рдореЗрдВ рдмрд░рдХрддред"</p>
            </div>
        </div>

        <div id="capture-screen" class="screen">
            <div id="camera-container">
                <video id="video-feed" autoplay playsinline muted></video>
                <img id="captured-image" alt="Captured Crop">
            </div>
            <div class="controls">
                <div id="initial-controls" class="btn-group">
                    <button class="btn-primary" onclick="capturePhoto()">ЁЯУ╖ рдлреЛрдЯреЛ рдЦреАрдВрдЪреЗрдВ</button>
                    <button class="btn-secondary" onclick="triggerFileUpload()">ЁЯЦ╝я╕П рдЧреИрд▓рд░реА рд╕реЗ рдЪреБрдиреЗрдВ</button>
                </div>
                <div id="review-controls" class="btn-group" style="display:none;">
                    <button class="btn-secondary" onclick="retakePhoto()">ЁЯФД рджреЛрдмрд╛рд░рд╛ рд▓реЗрдВ</button>
                    <button class="btn-action" onclick="goToAnalysis()">тЬЕ рдЖрдЧреЗ рдмреЭреЗрдВ (Next)</button>
                </div>
            </div>
            <input type="file" id="file-input" accept="image/*" onchange="handleFileUpload(event)">
            <canvas id="canvas" style="display:none;"></canvas>
            <button class="btn-secondary" onclick="location.reload()" style="margin-top:10px;">ЁЯПа рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ</button>
        </div>

        <div id="loading-screen" class="screen">
            <div class="spinner"></div>
            <h3>рдлрд╕рд▓ рдХреА рдЬрд╛рдВрдЪ рд╣реЛ рд░рд╣реА рд╣реИ...</h3>
            <p>рдХреГрдкрдпрд╛ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ</p>
            <div class="ai-notice">тЬи Image Analysis Powered by Agent</div>
        </div>

        <div id="result-screen" class="screen">
            <div id="error-message" class="message-box"></div>
            <div id="diagnosis-section" class="result-card" style="display:none;">
                <h2 class="result-title">ЁЯФН рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг (Problem Details)</h2>
                <div id="diagnosis-content" class="diagnosis-content"></div>
            </div>
            <div id="solution-section" class="marketing-box" style="display:none;">
                <h2 class="result-title" style="border-color: #d84315; color: #d84315;">ЁЯТК рд╕рдорд╛рдзрд╛рди (Solution)</h2>
                <div class="marketing-text">
                    <p>рд░реЛрдЧ рдХреА рдЕрд╕рд▓реА рджрд╡рд╛ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА рд╢реЙрдк рдкрд░ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред</p>
                    <p>рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдирдХрд▓реА рджрд╡рд╛рдУрдВ рд╕реЗ рдмрдЪреЗрдВред рд╣рдо 100% рдЬреЗрдиреНрдпреБрдЗрди рдкреНрд░реЛрдбрдХреНрдЯ рджреЗрддреЗ рд╣реИрдВред</p>
                    <p><strong>ЁЯУН рдкрддрд╛: Main Road Badayala Mataji, Ratlam (MP)</strong></p>
                </div>
                <button onclick="openModal()" class="shop-btn">рджрд╡рд╛рдИ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ</button>
            </div>
            <button class="btn-secondary" style="margin-top: 20px;" onclick="location.reload()">ЁЯПа рд╣реЛрдо рдкрд░ рдЬрд╛рдПрдБ</button>
        </div>
    </main>

    <div id="contact-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">ЁЯУЮ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ</div>
            <div class="input-group">
                <label>рдЖрдкрдХрд╛ рдирд╛рдо (Name)</label>
                <input type="text" id="user-name" class="input-field" placeholder="рдЕрдкрдирд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ...">
            </div>
            <div class="input-group">
                <label>рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ (Mobile)</label>
                <input type="tel" id="user-mobile" class="input-field" placeholder="10 рдЕрдВрдХреЛрдВ рдХрд╛ рдирдВрдмрд░...">
            </div>
            <button class="btn-primary btn-go" onclick="submitForm()">ЁЯЪА GO</button>
            <div class="close-modal" onclick="closeModal()">рд░рджреНрдж рдХрд░реЗрдВ (Cancel)</div>
        </div>
    </div>

    <script>
        // ==========================================
        // тЪая╕П SETUP CONFIGURATION
        // ==========================================
        // 1. рдпрд╣рд╛рдБ рдЕрдкрдиреА Gemini API Key рдбрд╛рд▓реЗрдВ
        const GEMINI_API_KEY = 'AIzaSyDIEV0sHlWIP1dld5z-AjUj8dcTylylZmI'; 
        
        // 2. рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП Telegram рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕
        const TELEGRAM_BOT_TOKEN = '8140645281:AAHDAEf80ks5rm16KOPyNcxbNqYR6gP-DIY'; 
        const TELEGRAM_CHAT_ID = '5961130033'; 
        
        // ==========================================
        // APP LOGIC
        // ==========================================
        const video = document.getElementById('video-feed');
        const capturedImage = document.getElementById('captured-image');
        const canvas = document.getElementById('canvas');
        const fileInput = document.getElementById('file-input');
        
        let stream = null;
        let finalImageBase64 = null;
        let latestDiagnosisText = ""; // AI рдХрд╛ рдЬрд╡рд╛рдм рд╕реЗрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП

        function startApp() {
            document.getElementById('landing-screen').classList.remove('active');
            document.getElementById('capture-screen').classList.add('active');
            initCamera(); 
        }

        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
            } catch (err) {
                alert("рдХреИрдорд░рд╛ рдЪрд╛рд▓реВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрд╛ред рдХреГрдкрдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрдВ рдпрд╛ рдЧреИрд▓рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред");
            }
        }

        function capturePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            showPreview(canvas.toDataURL('image/jpeg', 0.8));
        }

        function triggerFileUpload() { fileInput.click(); }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => showPreview(e.target.result);
                reader.readAsDataURL(file);
            }
        }

        function showPreview(dataUrl) {
            finalImageBase64 = dataUrl;
            video.style.display = 'none';
            capturedImage.src = dataUrl;
            capturedImage.style.display = 'block';
            document.getElementById('initial-controls').style.display = 'none';
            document.getElementById('review-controls').style.display = 'flex';
        }

        function retakePhoto() {
            finalImageBase64 = null;
            capturedImage.style.display = 'none';
            video.style.display = 'block';
            document.getElementById('review-controls').style.display = 'none';
            document.getElementById('initial-controls').style.display = 'flex';
        }

        function goToAnalysis() {
            document.getElementById('capture-screen').classList.remove('active');
            document.getElementById('loading-screen').classList.add('active');
            if (stream) stream.getTracks().forEach(track => track.stop());
            performAIAnalysis();
        }

        // ==========================================
        // AI LOGIC
        // ==========================================
        async function performAIAnalysis() {
            if (!finalImageBase64) return alert("рдлреЛрдЯреЛ рдирд╣реАрдВ рдорд┐рд▓реА");

            const modelName = 'gemini-robotics-er-1.5-preview';
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${GEMINI_API_KEY}`;
            
            const promptText = `You are an agricultural expert. Verify if image is crop/plant. If not return "NOT_CROP_ERROR". If yes, diagnose disease in PURE HINDI bullets. No medicine names.`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: promptText },
                                { inline_data: { mime_type: "image/jpeg", data: finalImageBase64.split(',')[1] } }
                            ]
                        }]
                    })
                });

                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                handleAIResult(text);
            } catch (error) {
                showResultScreen(false, "рд╕рд░реНрд╡рд░ рдПрд░рд░: " + error.message);
            }
        }

        function handleAIResult(text) {
            if (text.includes("NOT_CROP_ERROR")) {
                showResultScreen(false, "рдХреГрдкрдпрд╛ рд╕рд┐рд░реНрдл рдлрд╕рд▓ рдХреА рдлреЛрдЯреЛ рд▓реЗрдВред");
            } else {
                // рд╕реЗрд╡ рдХрд░реЗрдВ рддрд╛рдХрд┐ WhatsApp/Telegram рдкрд░ рднреЗрдЬрд╛ рдЬрд╛ рд╕рдХреЗ
                // (рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд┐рддрд╛рд░реЗ * рд╣рдЯрд╛ рд░рд╣реЗ рд╣реИрдВ рддрд╛рдХрд┐ рдореИрд╕реЗрдЬ рд╕рд╛реЮ рджрд┐рдЦреЗ)
                latestDiagnosisText = text.replace(/\*/g, '').trim();

                let html = text.replace(/\*/g, 'тАв').split('\n').map(l => l.trim().length > 0 ? `<p>${l}</p>` : '').join('');
                showResultScreen(true, html);
            }
        }

        function showResultScreen(success, content) {
            document.getElementById('loading-screen').classList.remove('active');
            document.getElementById('result-screen').classList.add('active');
            if (success) {
                document.getElementById('diagnosis-content').innerHTML = content;
                document.getElementById('diagnosis-section').style.display = 'block';
                document.getElementById('solution-section').style.display = 'block';
                document.getElementById('error-message').style.display = 'none';
            } else {
                document.getElementById('error-message').innerText = content;
                document.getElementById('error-message').style.display = 'block';
            }
        }

        // ==========================================
        // MODAL & SUBMIT LOGIC
        // ==========================================
        function openModal() {
            document.getElementById('contact-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }

        async function submitForm() {
            const name = document.getElementById('user-name').value.trim();
            const mobile = document.getElementById('user-mobile').value.trim();

            if (!name || !mobile) {
                alert("рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдирд╛рдо рдФрд░ рдирдВрдмрд░ рднрд░реЗрдВред");
                return;
            }

            // Button Loading State
            const btn = document.querySelector('.btn-go');
            btn.innerText = "Processing...";
            btn.disabled = true;

            // 1. Send to Telegram (With AI Diagnosis)
            if (TELEGRAM_BOT_TOKEN && TELEGRAM_CHAT_ID && finalImageBase64) {
                try {
                    await sendToTelegram(name, mobile, latestDiagnosisText, finalImageBase64);
                } catch (e) {
                    console.error("Telegram send failed", e);
                }
            }

            // 2. Open WhatsApp (With AI Diagnosis)
            const waNumber = "916264699580";
            // рдореИрд╕реЗрдЬ рдореЗрдВ "ЁЯЪл Problem :" рдЬреЛреЬрд╛ рдЧрдпрд╛ рд╣реИ
            const message = `рдирдорд╕реНрддреЗ, рдореЗрд░рд╛ рдирд╛рдо ${name} рд╣реИ (Mobile: ${mobile})ред\n\nЁЯЪл Problem : ${latestDiagnosisText}\n\nрдореИрдВрдиреЗ рдлрд╕рд▓ рдХреА рдлреЛрдЯреЛ рднреЗрдЬреА рд╣реИ, рдореБрдЭреЗ рджрд╡рд╛рдИ рдЪрд╛рд╣рд┐рдПред`;
            
            const waURL = `https://wa.me/${waNumber}?text=${encodeURIComponent(message)}`;
            
            // Redirect
            window.location.href = waURL;
        }

        // Telegram Sender
        async function sendToTelegram(name, mobile, diagnosis, base64) {
            const blob = await (await fetch(base64)).blob();
            const formData = new FormData();
            formData.append("chat_id", TELEGRAM_CHAT_ID);
            formData.append("photo", blob, "crop.jpg");
            
            // Telegram Caption рдореЗрдВ рднреА AI Problem рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рд╣реИ
            const captionText = `ЁЯМ▒ New Crop Query\nЁЯСд Name: ${name}\nЁЯУ▒ Mobile: ${mobile}\n\nЁЯЪл Problem : ${diagnosis}`;
            
            formData.append("caption", captionText);

            await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: formData
            });
        }
    </script>
</body>
</html>
